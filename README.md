# QRKot - Благотворительный фонд поддержки котиков

## Описание
QRkot - это API сервиса по сбору средств для финансирования благотворительных проектов. В сервисе реализована возможность регистрации пользователей, добавления благотворительных проектов и пожертвований, которые распределяются по открытым проектам.

Реализована возможность получить отчет с перечнем профинансированных проектов, отсортированных по времени, потребовавшимся для полного закрытия.

В приложении должно быть три модели: 
- Пользователи (User)
- Проекты (Charityproject)
- Пожертвования (Donation)

# Проекты
Столбцы таблицы charityproject:
- id — первичный ключ;
- name — уникальное название проекта, обязательное строковое поле; допустимая длина строки — от 1 до 100 символов включительно;
- description — описание, обязательное поле, текст; не менее одного символа;
- full_amount — требуемая сумма, целочисленное поле; больше 0;
- invested_amount — внесённая сумма, целочисленное поле; значение по умолчанию — 0;
- fully_invested — булево значение, указывающее на то, собрана ли нужная сумма для проекта (закрыт ли проект); значение по умолчанию — False;
- create_date — дата создания проекта, тип DateTime, должно добавляться автоматически в момент создания проекта.
- close_date — дата закрытия проекта, DateTime, проставляется автоматически в момент набора нужной суммы.

## Права пользователей
Любой посетитель сайта (в том числе неавторизованный) может посмотреть список всех проектов.

## Суперпользователь может: 
создавать проекты,
удалять проекты, в которые не было внесено средств,
изменять название и описание существующего проекта, устанавливать для него новую требуемую сумму (но не меньше уже внесённой).
Никто не может менять через API размер внесённых средств, удалять или модифицировать закрытые проекты, изменять даты создания и закрытия проектов.

# Пожертвования
Столбцы таблицы donation:
- id — первичный ключ;
- user_id — id пользователя, сделавшего пожертвование. Foreign Key на поле user.id из таблицы пользователей;
- comment — необязательное текстовое поле;
- full_amount — сумма пожертвования, целочисленное поле; больше 0;
- invested_amount — сумма из пожертвования, которая распределена по проектам; значение по умолчанию равно 0;
- fully_invested — булево значение, указывающее на то, все ли деньги из пожертвования были переведены в тот или иной проект; по умолчанию равно False;
- create_date — дата пожертвования; тип DateTime; добавляется автоматически в момент поступления пожертвования;
- close_date — дата, когда вся сумма пожертвования была распределена по проектам; тип DateTime; добавляется автоматически в момент выполнения условия.

## Права пользователей
Любой зарегистрированный пользователь может сделать пожертвование.
Зарегистрированный пользователь может просматривать только свои пожертвования, при этом ему выводится только четыре поля:
- id
- comment
- full_amount
- create_date

Информация о том, инвестировано пожертвование в какой-то проект или нет, обычному пользователю недоступна.
Суперпользователь может просматривать список всех пожертвований, при этом ему выводятся все поля модели.
Редактировать или удалять пожертвования не может никто.

# Запуск проекта
Клонируйте репозиторий
```
git clone git@github.com:Vadikray/cat_charity_fund.git
```
Установите и активируйте виртуальное окружение
```
python3 -m venv venv
source venv/Scripts/activate
```
Установите зависимости из файла requirements.txt
```
pip install -r requirements.txt
python3 -m pip install --upgrade pip
```
Запускаем проект
```
uvicorn app.main:app
```
Документация будет доступна по адресу 
```
localhost/docs
```
# Шаблон наполнения .env файла
```
APP_TITLE=Благотворительного фонда поддержки котиков
APP_DESCRIPTION = Фонд собирает пожертвования на различные целевые проекты:
DATABASE_URL=sqlite+aiosqlite:///./fastapi.db
SECRET=SECRET

# Переменные для работы с Google API
TYPE=service_account
PROJECT_ID=<идентификатор>
PRIVATE_KEY_ID=<id приватного ключа>
PRIVATE_KEY="-----BEGIN PRIVATE KEY-----<приватный ключ>-----END PRIVATE KEY-----\n"
CLIENT_EMAIL=<email сервисного аккаунта>
CLIENT_ID=<id сервисного аккаунта>
AUTH_URI=https://accounts.google.com/o/oauth2/auth
TOKEN_URI=https://oauth2.googleapis.com/token
AUTH_PROVIDER_X509_CERT_URL=https://www.googleapis.com/oauth2/v1/certs
CLIENT_X509_CERT_URL=<ссылка>
EMAIL=<email пользователя>
```
# Технологии
- Python 3.9
- FastAPI 0.78
- SQLAlchemy 1.4
- Google API

## Автор
[Конюшков В.А.](https://t.me/Vadikray)